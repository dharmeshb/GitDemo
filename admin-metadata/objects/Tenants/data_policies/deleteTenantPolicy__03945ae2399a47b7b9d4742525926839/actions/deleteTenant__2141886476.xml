<workflow_actions>
<id>2141886476</id>
<name>deleteTenant</name>
<action_order>1</action_order>
<type>EXECUTE_JAVA_CODE</type>
<subject></subject>
<description></description>
<end_date>0</end_date>
<flag_owner>0</flag_owner>
<owner></owner>
<email_to></email_to>
<email_additional_to></email_additional_to>
<email_from></email_from>
<cc></cc>
<beanshell_code>// delete record should delete the tenant and his database

String isMsp = (String)requestParams.get(&quot;msp&quot;);

String partner = (String)requestParams.get(&quot;partner&quot;);

String deleted = (String)requestParams.get(&quot;deleted&quot;);

if(deleted != null &amp;&amp; deleted.equals(&quot;1&quot;))
  
throwError(&quot;Tenant  has been deleted  already&quot;);

if (isMsp != null &amp;&amp; isMsp.equals(&quot;1&quot;))
{
  
   String mspId = (String)requestParams.get(&quot;number&quot;);

   
Result result = searchRecords(&quot;Tenants&quot;, &quot;record_id&quot;,&quot;(partner_id equals &quot; + &quot;&apos;&quot; + mspId + &quot;&apos;) and (deleted not equal to &apos;1&apos;)&quot;);
           

   
int resultCode = result.getCode();


   if(resultCode &lt; 0)
   {

                throwError(&quot;MSP tenant records could not be retrieved&quot;);

   }

   
else if(resultCode &gt; 0)

   {

                throwError(&quot;MSP tenant cannot be deleted, it has tenants.&quot;); 

   }

}
 
   

if (partner != null &amp;&amp; !partner.equals(&quot;&quot;))
   throwError(&quot;MSP&apos;s client can&apos;t be deleted.&quot;);
      

// passing customer id  because we are deleting the customer 
String customerId = (String)requestParams.get(&quot;number&quot;);

Result rs = deleteRecord(&quot;TENANT&quot;, customerId );

debug(&quot;error_code&quot; +rs.getCode());
if (rs.getCode() == -1)
{
   
throwError(&quot;Error deleting tenant&quot;);
}

if (rs.getCode() == 0)
{
	Parameters p = getParametersInstance();
	p.add(&quot;deleted&quot;,&quot;1&quot;);
	
Result result = updateRecord(&quot;Tenants&quot;,(String)requestParams.get(&quot;record_id&quot;),p);
	debug(result.getCode());
 	addSavePoint(&quot;point1&quot;);
	
//throwError(&quot;Tenant has been deleted&quot;);
}</beanshell_code>
<date_created></date_created>
<date_modified></date_modified>
<created_id></created_id>
<modified_id></modified_id>
<policy_id>03945ae2399a47b7b9d4742525926839</policy_id>
<object_id>8c5b349851c041a28d19277a12dee8f0</object_id>
<update_column></update_column>
<update_value></update_value>
<soap_server_url></soap_server_url>
<soap_server_port>0</soap_server_port>
<soap_message></soap_message>
<soap_action></soap_action>
<soap_content_type></soap_content_type>
<is_deleted>0</is_deleted>
<editor_type>0</editor_type>
<emailfrom_userid></emailfrom_userid>
<affiliate_id></affiliate_id>
<bcc></bcc>
</workflow_actions>
